<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenDeep - Schedule AI Call Task</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"], input[type="tel"], input[type="datetime-local"], textarea {
            width: calc(100% - 22px); padding: 10px; margin-top: 5px; border-radius: 4px; border: 1px solid #ddd;
            box-sizing: border-box;
        }
        textarea { min-height: 100px; resize: vertical; }
        button {
            background-color: #007bff; color: white; padding: 10px 15px; border: none;
            border-radius: 4px; cursor: pointer; margin-top: 20px; font-size: 16px;
        }
        button:hover { background-color: #0056b3; }
        .button-secondary { background-color: #6c757d; }
        .button-secondary:hover { background-color: #545b62; }
        .info-box { margin-top: 15px; padding: 10px; background-color: #e9ecef; border-radius: 4px; border: 1px solid #ced4da; }
        .error-box { margin-top: 15px; padding: 10px; background-color: #f8d7da; color: #721c24; border-radius: 4px; border: 1px solid #f5c6cb;}
        .status-message { margin-top: 15px; padding: 10px; border-radius: 4px; }
        .status-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;}
        .hidden { display: none; }
        .spinnerOkay, great.

Next, we'll start populating the `web_interface` directory {
            border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%;
            width: 20px; height:, beginning with the HTML template.

**File: `web_interface/templates/index.html`** (Phase 1 20px; animation: spin 1s linear infinite;
            display: inline-block; margin-left, File 11 - Basic Structure)

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content=": 10px; vertical-align: middle;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Schedule New AI Call Taskwidth=device-width, initial-scale=1.0">
    <title>OpenDeep - Schedule AI Call Task</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px</h1>

        <form id="taskForm">
            <h2>Task Details</h2>
            <label for="user_task_description">Describe the task for the AI agent:</label>
            <textarea id="user_task_description" name="user_task_description" rows="4" required placeholder="e.g., Call John Doe to; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 700px; margin: auto; }
        h1, h2 { color: #333; text-align: center; }
        label { display: block; margin-top: 15px; confirm his appointment for next Tuesday at 10 AM. If he can't make it, try to reschedule for Wednesday."></textarea>

            <div id="llmQuestionsSection" class="info-box hidden">
                <p><strong>The AI needs more information to create the agent instructions:</strong></p>
                <ul id="llm margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="datetime-local"], textarea, select {
            width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border: 1px solidQuestionsList"></ul>
                <label for="additional_info">Your answers:</label>
                <textarea id="additional_info" name="additional_info" rows="3"></textarea>
            </div>

            <button type="button" id="generateInstructionsBtn">
                Generate/Refine Agent Instructions <span id="generateSpinner" class="spinner hidden"></span>
 #ddd; border-radius: 4px; box-sizing: border-box;
        }
        textarea { min-height: 100px; resize: vertical; }
        button {
            background-color: #007bff; color: white; padding: 10px 15px; border:            </button>
            <div id="generateError" class="error-box hidden"></div>


            <h2>Agent Instructions (Generated by AI)</h2>
            <div class="info-box">
                <p>Review none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; margin-right: 5px;
        }
        button:hover { background-color: and edit the instructions below if necessary. These will be given to the AI phone agent.</p>
            </div>
            < #0056b3; }
        .button-secondary { background-color: #6c757d; }
        .button-secondary:hover { background-color: #545b62; }
label for="generated_agent_prompt">Agent Instructions:</label>
            <textarea id="generated_agent_prompt" name="generated_agent_prompt" rows="8" required placeholder="AI will generate instructions here based on your task description..."></        #llmInteractionArea, #generatedPromptArea, #statusMessage { margin-top: 15px; padding: 10px; border: 1px dashed #ccc; border-radius: 4px; background-colortextarea>

            <h2>Call Target & Schedule</h2>
            <label for="phone_number">Phone Number to Call:</label>
            <input type="tel" id="phone_number" name="phone_number" required placeholder="+15551234567">

            <label for="person_name">Person's Name (: #f9f9f9; }
        .hidden { display: none; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight:Optional):</label>
            <input type="text" id="person_name" name="person_name" placeholder="John Doe">

            <label for="business_name">Business Name (Optional):</label>
            <input bold; }
        .info { color: #0056b3; }
        .form-group { margin-bottom: 15px; }
    </style>
</head>
<body>
    < type="text" id="business_name" name="business_name" placeholder="Acme Corp">

            <label for="initial_schedule_time">Schedule Time:</label>
            <input type="datetime-local" iddiv class="container">
        <h1>Schedule AI Call Task</h1>

        <div id="statusMessage"></div>

        <div class="form-group">
            <label for="userTaskDescription">1. Describe the Task for the AI Agent="initial_schedule_time" name="initial_schedule_time" required>

            <button type="submit" id="scheduleTaskBtn">
                Schedule Task <span id="scheduleSpinner" class="spinner hidden"></span>
            </button>
        </form>

        <div id="statusMessage" class="status-message hidden"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const:</label>
            <textarea id="userTaskDescription" name="userTaskDescription" rows="4" placeholder="e.g., Call John Doe to confirm his appointment for next Tuesday at 2 PM for a dental check-up. If form = document.getElementById('taskForm');
            const generateInstructionsBtn = document.getElementById('generateInstructionsBtn');
            const scheduleTaskBtn = document.getElementById('scheduleTaskBtn');

            const userTaskDescriptionEl = document.getElementById('user_task_description');
            const generatedAgentPromptEl = document.getElementById('generated_agent_prompt he can't make it, try to reschedule for Wednesday or Thursday afternoon."></textarea>
        </div>

        <div id="llmInteractionArea" class="hidden">
            <h2>AI Assistant Needs More Information:</h2>
            <div id="ll');
            const phoneNumberEl = document.getElementById('phone_number');
            const personNameEl = document.getElementById('person_name');
            const businessNameEl = document.getElementById('business_name');
            const initialScheduleTimeEl = document.getElementById('initial_schedule_time');

            const llmQuestionsSection = document.mQuestions"></div>
            <label for="userResponseToLLM">Your Response:</label>
            <textarea id="userResponseToLLM" rows="3"></textarea>
            <button id="submitLLMResponse">Submit Response to AI</button>
        </div>

        <button id="generateInstructionsBtn">Generate/Refine Agent Instructions</button>
        <hr style="margin: 20px 0;">

        <div id="generatedPromptgetElementById('llmQuestionsSection');
            const llmQuestionsList = document.getElementById('llmQuestionsList');
            const additionalInfoEl = document.getElementById('additional_info');
            const generateErrorEl = document.getElementById('generateError');
            const statusMessageEl = document.getElementById('statusMessage');
            const generateSpinner = document.getElementById('generateSpinner');
            const scheduleSpinner = document.getElementById('scheduleSpinner');

            // Set default schedule time to now + 5 minutes for convenience
            const now = new Date();
            now.setMinutes(now.getMinutes() +Area" class="hidden">
            <h2>2. Generated Agent Instructions (Review & Edit if Needed):</h2>
            <textarea id="generatedAgentPrompt" name="generatedAgentPrompt" rows="8" placeholder="AI will generate instructions here..."></ 5 - now.getTimezoneOffset()); // Adjust for local timezone
            initialScheduleTimeEl.value = now.toISOString().slice(0, 16);


            generateInstructionsBtn.addEventListener('click', async function () {
                const userDescription = userTaskDescriptionEl.value.trim();
                if (!userDescription) {
                    textarea>
        </div>

        <h2>3. Call Details:</h2>
        <div class="form-group">
            <label for="phoneNumber">Phone Number to Call:</label>
            <input type="text" id="phoneNumber" name="phoneNumber" placeholder="+15551234567" required>
        </div>

        <div class="form-group">
            <label for="initialScheduleTime">Schedule Time (Your Local Time):</label>
            <input type="datetime-local" id="initialScheduleTime" name="initialScheduleTime" required>
        </div>
        
        <div class="form-group">
            <label for="businessName">showError(generateErrorEl, 'Please describe the task first.');
                    return;
                }
                hideElement(generateErrorEl);
                showElement(generateSpinner);
                generateInstructionsBtn.disabled = true;

                const payload = {
                    user_task_description: userDescription,
                    existing_details: { // Collect existing details if any were provided for refinement
                        person_name: personNameEl.value.trim(),
                        business_nameBusiness Name (Optional):</label>
            <input type="text" id="businessName" name="businessName" placeholder="e.g., Acme Corp">
        </div>
        
        <div class="form-group">
            <label for="personName">Person's Name (Optional):</label>
            <input type="text" id="personName" name="personName" placeholder="e.g., Jane Doe">
        </div>

        <div class: businessNameEl.value.trim(),
                        phone_number: phoneNumberEl.value.trim(),
                        // We could also send current generated_agent_prompt if user is refining
                    },
                    user_answers: llmQuestionsSection.classList.contains('hidden') ? null : additionalInfoEl.value.trim()
                };

                try {
                    const response = await fetch('/api/generate_agent_prompt', {
                        method:="form-group">
            <label for="maxAttempts">Max Call Attempts (Optional, default 3):</label>
            <input type="number" id="maxAttempts" name="maxAttempts" min="1" max="10" placeholder="3">
        </div>


        <button id="scheduleTaskBtn" class="button-main" disabled>Schedule Task</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        if (result.status === 'prompt_generated') {
                            generatedAgentPromptEl.value = result. () {
            const generateBtn = document.getElementById('generateInstructionsBtn');
            const scheduleBtn = document.getElementById('scheduleTaskBtn');
            const userTaskDescEl = document.getElementById('userTaskDescription');
            const generatedPromptEl = document.getElementById('generatedAgentPrompt');
            const generatedPromptArea = document.getElementById('generatedPromptAreaagent_prompt;
                            hideElement(llmQuestionsSection);
                            additionalInfoEl.value = ''; // Clear answers
                        } else if (result.status === 'needs_more_info') {
                            llmQuestionsList.innerHTML = ''; // Clear previous questions
                            result.questions.forEach(q => {
                                const li = document.createElement');
            const llmInteractionArea = document.getElementById('llmInteractionArea');
            const llmQuestionsEl = document.getElementById('llmQuestions');
            const userResponseToLLMEl = document.getElementById('userResponseToLLM');
            const submitLLMResponseBtn = document.getElementById('submitLLMResponse');('li');
                                li.textContent = q;
                                llmQuestionsList.appendChild(li);
                            });
                            showElement(llmQuestionsSection);
                            generatedAgentPromptEl.placeholder = "Please answer the questions above and click 'Generate/Refine' again.";
                        } else {
                           showError(generateErrorEl, result
            const statusMessageEl = document.getElementById('statusMessage');

            // Form data elements
            const phoneNumberEl = document.getElementById('phoneNumber');
            const initialScheduleTimeEl = document.getElementById('initialScheduleTime');.detail || 'Unknown success state.');
                        }
                    } else {
                        showError(generateErrorEl, result.detail || `Error: ${response.statusText}`);
                    }
                } catch (error) {
            const businessNameEl = document.getElementById('businessName');
            const personNameEl = document.getElementById('personName');
            const maxAttemptsEl = document.getElementById('maxAttempts');

            let currentLLMContext
                    showError(generateErrorEl, `Network or server error: ${error.message}`);
                } finally {
                    hideElement(generateSpinner);
                    generateInstructionsBtn.disabled = false;
                }
             = {}; // To store details for iterative LLM calls

            function displayMessage(message, type = 'info') {
                statusMessageEl.innerHTML = `<p class="${type}">${message}</p>`;
            }

            async function handle});

            form.addEventListener('submit', async function (event) {
                event.preventDefault(); // Prevent default form submission

                const formData = {
                    user_task_description: userTaskDescriptionEl.value.trim(),
                    generated_agent_prompt: generatedAgentPromptEl.value.trim(),
                    phone_number: phoneNumberEl.valueGenerateInstructions() {
                const userTaskDescription = userTaskDescEl.value.trim();
                if (!userTaskDescription) {
                    displayMessage('Please describe the task for the AI agent.', 'error');
                    return;
                }
                displayMessage('Generating instructions, please wait...', 'info');
                generateBtn.disabled = true;
                scheduleBtn.disabled = true;

                try {
                    const response = await fetch('/.trim(),
                    person_name: personNameEl.value.trim() || null,
                    business_name: businessNameEl.value.trim() || null,
                    initial_schedule_time: initialScheduleTimeEl.value
                };

                if (!formData.generated_agent_prompt) {
                    showStatus('Please generate agent instructionsapi/generate_agent_prompt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            user_task_description: userTaskDescription,
                            existing_details: currentLLMContext // Send context for refinement
                        })
 first.', 'error');
                    return;
                }
                if (!formData.phone_number) {
                    showStatus('Phone number is required.', 'error');
                    return;
                }
                 if (!formData.initial_schedule_time) {
                    showStatus('Schedule time is required.', 'error');
                    return;
                }

                    });
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.detail || 'Failed to generate instructions.');
                    }

                    if (data.status === 'needs_more_info') {
                        llmQuestionsEl.innerHTML = '<ul>' + data.questions.map                showElement(scheduleSpinner);
                scheduleTaskBtn.disabled = true;
                hideElement(statusMessageEl);

                try {
                    const response = await fetch('/api/schedule_task', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    const result = await response.json();

                    if (response.ok) {(q => `<li>${q}</li>`).join('') + '</ul>';
                        llmInteractionArea.classList.remove('hidden');
                        generatedPromptArea.classList.add('hidden');
                        displayMessage('AI needs more information to proceed.', 'info');
                        currentLLMContext = data.current_details || {}; // Update context
                    } else
                        showStatus(`Task scheduled successfully! Task ID: ${result.task_id}`, 'success');
                        form.reset(); // Optionally reset form
                        // Reset default schedule time again after form reset
                        const now = new Date if (data.status === 'prompt_generated') {
                        generatedPromptEl.value = data.agent_prompt;
                        generatedPromptArea.classList.remove('hidden');
                        llmInteractionArea.classList.add('hidden');
                        userResponseToLLMEl.value = ''; // Clear previous response
                        displayMessage('Agent instructions generated successfully.();
                        now.setMinutes(now.getMinutes() + 5 - now.getTimezoneOffset());
                        initialScheduleTimeEl.value = now.toISOString().slice(0,16);
                        hideElement(llmQuestionsSection);
                        additionalInfoEl.value = '';
                    } else {
                        showStatus(result.detail || Review and proceed to schedule.', 'success');
                        scheduleBtn.disabled = false; // Enable schedule button
                        currentLLMContext = {}; // Reset context after successful generation
                    } else {
                        displayMessage(data.message || 'Unknown response `Error scheduling task: ${response.statusText}`, 'error');
                    }
                } catch (error) {
                    showStatus(`Network or server error: ${error.message}`, 'error');
                } finally {
                    hideElement(scheduleSpinner);
                    scheduleTaskBtn.disabled = false;
                }
            });

            function show from server.', 'error');
                    }
                } catch (error) {
                    console.error('Error generating instructions:', error);
                    displayMessage('Error: ' + error.message, 'error');
                } finally {
Element(el) { el.classList.remove('hidden'); }
            function hideElement(el) { el.classList.add('hidden'); }
            function showError(el, message) {
                el.textContent = message;
                showElement(el);
            }
            function showStatus(message, type = 'info                    generateBtn.disabled = false;
                }
            }
            
            generateBtn.addEventListener('click', handleGenerateInstructions);

            submitLLMResponseBtn.addEventListener('click', async function() {
                const userResponse = userResponseToLLMEl.value.trim();
                if (!userResponse) {
                    displayMessage('Please provide your response to the AI.', 'error');
                    return;
                }
                // Add user's response') { // type can be 'success', 'error', 'info'
                statusMessageEl.textContent = message;
                statusMessageEl.className = 'status-message'; // Reset classes
                if (type === 'success') statusMessageEl.classList.add('status-success');
                else if (type === 'error') status to the context for the next LLM call
                // This is a simplistic way; backend might structure context better
                currentLLMContext.user_clarification = userResponse; 
                
                // Re-trigger instruction generation with the new information
                await handleGenerateInstructions(); 
            });

            scheduleBtn.addEventListener('click', async function () {MessageEl.classList.add('status-error');
                showElement(statusMessageEl);
            }
        });
    </script>
</body>
</html>